#! /bin/bash

# Config variable, modify to your needs
EMAIL_TO='recipient@email.com'
EMAIL_FROM='sender@email.com'
EMAIL_SUBJECT="File changes on $(date +%Y-%m-%d)"
FOLDER_PATH='/home/[username]/public_html'
declare -a IGNORED_FOLDERS=(
  'images/user-cards'
  'images/profile-covers'
);
declare -a IGNORED_FILES=(
  'error_log'
);

# Construct statement to ignore defined folders
for ign_folder in "${IGNORED_FOLDERS[@]}"; do
  statement+=" ! -path *$ign_folder*"
done

# Construct statement to ignore defined files
for ign_file in "${IGNORED_FILES[@]}"; do
  statement+=" ! -name $ign_file"
done

# Find all changes made in the past 1 day (24h), send errors to /dev/null
echo 'Fecthing changes, this may take a few minutes.'
files=( $(find $FOLDER_PATH -ctime -1 -type f $statement 2> /dev/null) )
echo '=============================================='

# Display results to terminal screen
for file in "${files[@]}"; do
  echo $file
  output+="$file\n" # Add newline for email output
dones

# Send an email with list of changed files
message="subject:$EMAIL_SUBJECT\nfrom:$EMAIL_FROM\n$output"
echo -e "$message" | sendmail $EMAIL_TO 
echo "Email sent to $EMAIL_TO"

unset files
